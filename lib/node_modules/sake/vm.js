
var VM      = require("vm"),
    FS      = require("fs"),
    Path    = require("path"),
    sakeCtx = require("sake/vm-context")
;

module.exports = {
    
    run: function (filepath) {
        var code, ret;
        
        if (typeof filepath === "function") {
            code = "(" + filepath.toString() + "())";
            filepath = "anonymous function";
        }
        else {
            code = FS.readFileSync(filepath, "utf8");
            
            if (Path.extname(filepath).toLowerCase() === ".coffee") {
                code = require("coffee-script").compile(code);
                console.log(code);
            }
        }
        
        ret = VM.runInContext(code, sakeCtx, filepath);
        return ret;
    }
    
};
