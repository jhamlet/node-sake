
var Path    = require("path"),
    Task    = require("sake/task")
;

/**
 * A FileCreationTask is a file task that when used as a dependency will
 * be needed if and only if the file has not been created.  Once created,
 * it is not re-triggered if any of its dependencies are newer, nor does
 * it trigger any rebuilds of tasks that depend on it whenever it is
 * updated.
 */
module.exports = Task.derive({
    type: "file-create-task",
    /**
     * @property isNeeded
     * @type {boolean}
     * @override Task#isNeeded
     */
    get isNeeded () {
        if (this.hasOwnProperty("__isNeeded__")) {
            return this.__isNeeded__;
        }
        return !Path.existsSync(this.name);
    },

    set isNeeded (v) {
        if (!this.hasOwnProperty("__isNeeded__")) {
            Object.defineProperty(this, "__isNeeded__", {
                value: v,
                writable: true
            });
        }
        this.__isNeeded__ = v;
    },
    
    /**
     * A FileCreateTask timestamp is always the distant past
     * @property timestamp
     * @type {integer}
     * @override Task#timestamp
     */
    get timestamp () {
        return 0;
    }
});
