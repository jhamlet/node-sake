
var Proteus     = require("proteus"),
    VM          = require("vm"),
    Path        = require("path"),
    sake        = require("sake"),
    fileUtils   = require("sake/file-utils"),
    resolve     = require("resolve"),
    nodeRequire = require
;

function sakeRequire (name) {
    try {
        return nodeRequire(name);
    }
    catch (e) {
        return nodeRequire(resolve.sync(name, {
            paths: sakeRequire.paths
        }));
    }
}

sakeRequire.paths = [__dirname, process.cwd()];

module.exports = VM.createContext(
    Proteus.merge(
        {
            console: console,
            require: sakeRequire,
            process: process
        },
        sake,
        fileUtils
    )
);
